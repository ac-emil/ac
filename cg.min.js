function setCookie(e,t,o){const n=new Date(Date.now()+36e5*o).toUTCString();document.cookie=`${e}=${t}; expires=${n}; path=/; SameSite=Lax`}function getCookie(e){const t=document.cookie.match(new RegExp("(^| )"+e+"=([^;]+)"));return t?t[2]:null}async function loadTrackingScriptsSequentially(){for(const e of trackingCodes)await new Promise(t=>{const o=document.createElement("script");o.type="text/javascript",e.hasAttribute("async")&&(o.async=!0),e.hasAttribute("defer")&&(o.defer=!0),e.src?(o.src=e.src,o.onload=(()=>{console.info(`Loaded script: ${e.src}`),t()}),o.onerror=(o=>{console.error(`Failed to load script: ${e.src}`,o),t()})):(o.textContent=e.textContent,t()),e.replaceWith(o)})}async function fetchCountryWithRetry(){const e=getCookie("userCountry");if(e)return console.info("Using cached country:",e),e;let t=0;for(;t<maxRetries;){try{const e=await fetch(geojs_api,{headers:{Accept:"application/json"}});if(e.ok){const t=await e.json(),o=(t.country||"UNKNOWN").toUpperCase();return setCookie("userCountry",o,cacheDurationHours),o}}catch(e){console.error(`Geo API error (attempt ${t+1}):`,e)}t++,await new Promise(e=>setTimeout(e,retryDelayMs*t))}return"UNKNOWN"}async function checkCountry(){if(window.location.pathname===accessDeniedPage)return;const e=await fetchCountryWithRetry();console.info(`Country Code: ${e}`),blockedCountries.includes(e)?window.location.href=accessDeniedPage:await loadTrackingScriptsSequentially()}const blockedCountries=["CN","RU","IN","PK","BD","BR","SG"],geojs_api="https://get.geojs.io/v1/ip/country.json",accessDeniedPage="/not-allowed",trackingCodes=document.querySelectorAll('script[type="ac-code"]'),cacheDurationHours=12,maxRetries=5,retryDelayMs=1e3;document.addEventListener("DOMContentLoaded",checkCountry);
